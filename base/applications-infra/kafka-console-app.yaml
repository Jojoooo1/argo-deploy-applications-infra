apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kafka-console
  namespace: argocd
  # Add this finalizer ONLY if you want these to cascade delete (A cascade delete, deletes both the app and its resources, rather than only the app.)
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  syncPolicy:
    syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground

  sources:
    - chart: console
      repoURL: https://charts.redpanda.com
      targetRevision: 0.6.9
      # https://github.com/redpanda-data/helm-charts/tree/main/charts/console
      helm:
        values: |
          ingress:
            enabled: true
            className: "nginx"
            hosts:
            - host: kafka.local.com.br
              paths:
                - path: /
                  pathType: ImplementationSpecific
              tls:
                - secretName: kafka-tls
                  hosts:
                    - kafka.local.com.br
                    
          console:
            # https://docs.redpanda.com/docs/reference/console/config/
            config:
              kafka:
                brokers:
                  - kafka-controller-0.kafka-controller-headless.kafka.svc.cluster.local.:9092
                clientId: console
                sasl:
                  enabled: true
                  mechanism: SCRAM-SHA-256
                  username: user
                  password: password
                tls:
                  enabled: false
                schemaRegistry:
                  enabled: false
                  tls:
                    enabled: false
                  urls:
                  - http://kafka.kafka.svc.cluster.local:8081

  ignoreDifferences:
    - kind: Secret
      namespace: redpanda
      name: redpanda-console
      jsonPointers:
        - /data/login-jwt-secret

  destination:
    server: "https://kubernetes.default.svc"
    namespace: kafka